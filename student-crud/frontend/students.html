<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Tələbələr</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        #header-text{
            color:green;
        }
    </style>
</head>

<body>
    <div style="width: 30%;margin: auto;">
        <h3 id="header-text"></h3>
        <form onsubmit="onSaveStudent(event)">
            <div class="form-group">
                <label for="student-name">Ad</label>
                <input id="student-name" class="form-control">
            </div>
            <div class="form-group">
                <label for="student-surname">Soyad</label>
                <input id="student-surname" class="form-control">
            </div>
            <input type="submit" value="Yadda saxla" class="btn btn-success">
        </form>

    </div>
    <hr>
    <div class="container">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Kod</th>
                    <th>Ad</th>
                    <th>Soyad</th>
                    <td></td>
                </tr>
            </thead>
            <tbody id="students-tbody">

            </tbody>

        </table>
    </div>
    <script>
        var selectedStudentId=0;
        function onSaveStudent(event) {
            event.preventDefault();
            var studentName = document.getElementById('student-name').value;
            var studentSurname = document.getElementById('student-surname').value;

            var studentObject = {};
            studentObject.id=selectedStudentId;
            studentObject.name = studentName;
            studentObject.surname = studentSurname;
            var http = new XMLHttpRequest();
            http.onload = function () {
                selectedStudentId=0;
                setHeaderText('Yeni tələbə qeydiyyatı');

                loadAllStudents();
            }
            http.open("POST", "http://localhost:8585/students", true);
            http.setRequestHeader("Content-type", "application/json");
            http.send(JSON.stringify(studentObject));
        }
        function loadAllStudents() {
            var http = new XMLHttpRequest();
            http.onload = function () {
                var response = this.responseText;
                var studentsArray = JSON.parse(response);
                fillStudentsTable(studentsArray);
            }
            http.open("GET", "http://localhost:8585/students", true);
            http.send();
        }
        function fillStudentsTable(students) {
            var studentsTbodyElement = document.getElementById('students-tbody');
            var studentsTbodyHtml = "";
            for (var i = 0; i < students.length; i++) {
                var student = students[i];
                studentsTbodyHtml += "<tr><td>" + student.id + "</td>";
                studentsTbodyHtml += "<td>" + student.name + "</td>";
                studentsTbodyHtml += "<td>" + student.surname + "</td>";

                studentsTbodyHtml += "<td><button class='btn btn-danger' onclick='onDeleteStudent(" + student.id + ")'>Sil</button> ";
                studentsTbodyHtml += "<button class='btn btn-primary' onclick='onEditStudent(" + student.id + ")'>Redakte</button></td></tr>";
            }
            studentsTbodyElement.innerHTML = studentsTbodyHtml;
        }
        loadAllStudents();
        function onDeleteStudent(studentId) {
            if(confirm('silmeye eminsiniz?')){
            var http = new XMLHttpRequest();
            http.onload = function () {
                loadAllStudents();
            }
            http.open("DELETE", "http://localhost:8585/students/" + studentId, true);
            http.send();
        }
        }
        function onEditStudent(studentId){
            selectedStudentId=studentId;
            setHeaderText('Tələbə redaktəsi, id='+studentId);
            var http = new XMLHttpRequest();
            http.onload = function () {
                var response=this.responseText;
                var studentObject=JSON.parse(response);
                document.getElementById('student-name').value=studentObject.name;
                document.getElementById('student-surname').value=studentObject.surname;
            }
            http.open("GET", "http://localhost:8585/students/" + studentId, true);
            http.send();
        }
        function setHeaderText(text){
            document.getElementById('header-text').innerHTML=text;
        }
        setHeaderText('Yeni tələbə qeydiyyatı');
    </script>
</body>

</html>